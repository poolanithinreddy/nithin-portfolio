{
  "title": "Mapping SAML roles to app RBAC without breaking sessions",
  "summary": "Practical lessons from aligning Shibboleth SAML assertions with fine-grained RBAC scopes in CyberRange.",
  "publishedAt": "2024-06-12T00:00:00.000Z",
  "tags": [
    "SAML",
    "Security",
    "RBAC"
  ],
  "body": {
    "raw": "\nKeeping campus identity providers in sync with application roles can go sideways quickly—especially when you introduce per-action audit requirements. This post outlines the guardrails we applied while wiring UMBC’s Shibboleth IdP to the CyberRange portal.\n\n## Start with a role contract\n\nBefore writing code, agree on a contract with the identity team. We specified:\n\n- Canonical attribute names (`urn:oid:1.3.6.1.4.1.5923.1.5.1.1` for eduPersonAffiliation)\n- Allowed values per attribute and what scopes they unlock\n- Expected NameID format (transient vs. persistent)\n\n## Map to scopes, not UI roles\n\nWe maintained a `scopes.json` that translated IdP roles to backend capabilities. The UI simply asked the API: “Does this user have `labs:power:cycle`?” That separation prevented awkward UI drift when the identity team renamed groups.\n\n## Harden the session lifecycle\n\n- Cookies set to `SameSite=strict`, `HttpOnly`, and `Secure`\n- AES-encrypted session payload with rotating keys stored in HashiCorp Vault\n- CSRF double-submit tokens on all mutation routes\n\n## Audit everything\n\nWe streamed sensitive events (console open, template clone, role change) to Mongo change streams and persisted them in Postgres for reporting. Every audit record links to the original SAML assertion, making compliance reviews painless.\n\n## Wrap-up\n\nThe end result: faculty now approve lab access with confidence that session state and RBAC scopes move in lockstep with campus identity.\n",
    "code": "var Component=(()=>{var h=Object.create;var s=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var y=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),w=(t,e)=>{for(var i in e)s(t,i,{get:e[i],enumerable:!0})},o=(t,e,i,a)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let r of u(e))!g.call(t,r)&&r!==i&&s(t,r,{get:()=>e[r],enumerable:!(a=p(e,r))||a.enumerable});return t};var f=(t,e,i)=>(i=t!=null?h(m(t)):{},o(e||!t||!t.__esModule?s(i,\"default\",{value:t,enumerable:!0}):i,t)),b=t=>o(s({},\"__esModule\",{value:!0}),t);var l=y((M,c)=>{c.exports=_jsx_runtime});var S={};w(S,{default:()=>C,frontmatter:()=>v});var n=f(l()),v={title:\"Mapping SAML roles to app RBAC without breaking sessions\",summary:\"Practical lessons from aligning Shibboleth SAML assertions with fine-grained RBAC scopes in CyberRange.\",publishedAt:\"2024-06-12\",tags:[\"SAML\",\"Security\",\"RBAC\"]};function d(t){let e=Object.assign({p:\"p\",h2:\"h2\",a:\"a\",ul:\"ul\",li:\"li\",code:\"code\"},t.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:\"Keeping campus identity providers in sync with application roles can go sideways quickly\\u2014especially when you introduce per-action audit requirements. This post outlines the guardrails we applied while wiring UMBC\\u2019s Shibboleth IdP to the CyberRange portal.\"}),`\n`,(0,n.jsx)(e.h2,{id:\"start-with-a-role-contract\",children:(0,n.jsx)(e.a,{href:\"#start-with-a-role-contract\",children:\"Start with a role contract\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Before writing code, agree on a contract with the identity team. We specified:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"Canonical attribute names (\",(0,n.jsx)(e.code,{children:\"urn:oid:1.3.6.1.4.1.5923.1.5.1.1\"}),\" for eduPersonAffiliation)\"]}),`\n`,(0,n.jsx)(e.li,{children:\"Allowed values per attribute and what scopes they unlock\"}),`\n`,(0,n.jsx)(e.li,{children:\"Expected NameID format (transient vs. persistent)\"}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{id:\"map-to-scopes-not-ui-roles\",children:(0,n.jsx)(e.a,{href:\"#map-to-scopes-not-ui-roles\",children:\"Map to scopes, not UI roles\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"We maintained a \",(0,n.jsx)(e.code,{children:\"scopes.json\"}),\" that translated IdP roles to backend capabilities. The UI simply asked the API: \\u201CDoes this user have \",(0,n.jsx)(e.code,{children:\"labs:power:cycle\"}),\"?\\u201D That separation prevented awkward UI drift when the identity team renamed groups.\"]}),`\n`,(0,n.jsx)(e.h2,{id:\"harden-the-session-lifecycle\",children:(0,n.jsx)(e.a,{href:\"#harden-the-session-lifecycle\",children:\"Harden the session lifecycle\"})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"Cookies set to \",(0,n.jsx)(e.code,{children:\"SameSite=strict\"}),\", \",(0,n.jsx)(e.code,{children:\"HttpOnly\"}),\", and \",(0,n.jsx)(e.code,{children:\"Secure\"})]}),`\n`,(0,n.jsx)(e.li,{children:\"AES-encrypted session payload with rotating keys stored in HashiCorp Vault\"}),`\n`,(0,n.jsx)(e.li,{children:\"CSRF double-submit tokens on all mutation routes\"}),`\n`]}),`\n`,(0,n.jsx)(e.h2,{id:\"audit-everything\",children:(0,n.jsx)(e.a,{href:\"#audit-everything\",children:\"Audit everything\"})}),`\n`,(0,n.jsx)(e.p,{children:\"We streamed sensitive events (console open, template clone, role change) to Mongo change streams and persisted them in Postgres for reporting. Every audit record links to the original SAML assertion, making compliance reviews painless.\"}),`\n`,(0,n.jsx)(e.h2,{id:\"wrap-up\",children:(0,n.jsx)(e.a,{href:\"#wrap-up\",children:\"Wrap-up\"})}),`\n`,(0,n.jsx)(e.p,{children:\"The end result: faculty now approve lab access with confidence that session state and RBAC scopes move in lockstep with campus identity.\"})]})}function A(t={}){let{wrapper:e}=t.components||{};return e?(0,n.jsx)(e,Object.assign({},t,{children:(0,n.jsx)(d,t)})):d(t)}var C=A;return b(S);})();\n;return Component;"
  },
  "_id": "blog/saml-rbac.mdx",
  "_raw": {
    "sourceFilePath": "blog/saml-rbac.mdx",
    "sourceFileName": "saml-rbac.mdx",
    "sourceFileDir": "blog",
    "contentType": "mdx",
    "flattenedPath": "blog/saml-rbac"
  },
  "type": "Post",
  "slug": "saml-rbac",
  "url": "/blog/saml-rbac"
}